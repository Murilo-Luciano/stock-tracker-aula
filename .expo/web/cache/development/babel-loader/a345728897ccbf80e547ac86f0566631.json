{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nimport { Duck } from \"./Duck\";\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\n\nvar AuthenticationDuck = function (_Duck) {\n  _inherits(AuthenticationDuck, _Duck);\n\n  var _super = _createSuper(AuthenticationDuck);\n\n  function AuthenticationDuck() {\n    var _this;\n\n    _classCallCheck(this, AuthenticationDuck);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _super.call.apply(_super, [this].concat(args));\n    _this.LOAD_TOKEN = _this.type(\"LOAD_TOKEN\");\n    _this.SIGN_OUT = _this.type(\"SIGN_OUT\");\n    _this.SIGN_IN_PENDING = _this.type(\"SIGN_IN_PENDING\");\n    _this.SIGN_IN_FULFILLED = _this.type(\"SIGN_IN_FULFILLED\");\n    _this.SIGN_IN_REJECTED = _this.type(\"SIGN_IN_REJECTED\");\n    return _this;\n  }\n\n  _createClass(AuthenticationDuck, [{\n    key: \"reducer\",\n    value: function reducer(state, action) {\n      if (!state) {\n        return this.initialState();\n      }\n\n      switch (action.type) {\n        case this.LOAD_TOKEN:\n          return _objectSpread(_objectSpread({}, state), {}, {\n            authToken: action.token,\n            isLoading: false\n          });\n\n        case this.SIGN_IN_PENDING:\n          return _objectSpread(_objectSpread({}, state), {}, {\n            authToken: action.token,\n            isLoading: true\n          });\n\n        case this.SIGN_OUT:\n          return _objectSpread(_objectSpread({}, state), {}, {\n            authToken: null,\n            isSignout: true\n          });\n\n        default:\n          return state;\n      }\n    }\n  }, {\n    key: \"signIn\",\n    value: function signIn() {\n      var _this2 = this;\n\n      return function _callee(dispatch) {\n        var dummyToken;\n        return _regeneratorRuntime.async(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.prev = 0;\n                dummyToken = \"12345678910\";\n                _context.next = 4;\n                return _regeneratorRuntime.awrap(AsyncStorage.setItem(\"@auth_token\", dummyToken));\n\n              case 4:\n                setTimeout(function () {\n                  return dispatch({\n                    type: _this2.SIGN_IN,\n                    token: dummyToken\n                  });\n                }, 3000);\n                _context.next = 9;\n                break;\n\n              case 7:\n                _context.prev = 7;\n                _context.t0 = _context[\"catch\"](0);\n\n              case 9:\n                ;\n\n              case 10:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, null, null, [[0, 7]], Promise);\n      };\n    }\n  }, {\n    key: \"signOut\",\n    value: function signOut() {\n      var _this3 = this;\n\n      return function _callee2(dispatch) {\n        return _regeneratorRuntime.async(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.next = 2;\n                return _regeneratorRuntime.awrap(AsyncStorage.removeItem(\"@auth_token\"));\n\n              case 2:\n                dispatch({\n                  type: _this3.SIGN_OUT\n                });\n\n              case 3:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, null, null, null, Promise);\n      };\n    }\n  }, {\n    key: \"loadToken\",\n    value: function loadToken() {\n      var _this4 = this;\n\n      return function _callee3(dispatch) {\n        var authToken;\n        return _regeneratorRuntime.async(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _context3.prev = 0;\n                _context3.next = 3;\n                return _regeneratorRuntime.awrap(AsyncStorage.getItem(\"@auth_token\"));\n\n              case 3:\n                authToken = _context3.sent;\n                _context3.next = 8;\n                break;\n\n              case 6:\n                _context3.prev = 6;\n                _context3.t0 = _context3[\"catch\"](0);\n\n              case 8:\n                setTimeout(function () {\n                  dispatch({\n                    type: _this4.LOAD_TOKEN,\n                    token: authToken\n                  });\n                }, 3000);\n\n              case 9:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, null, null, [[0, 6]], Promise);\n      };\n    }\n  }, {\n    key: \"initialState\",\n    value: function initialState() {\n      return {\n        isLoading: true,\n        authToken: null\n      };\n    }\n  }, {\n    key: \"namespace\",\n    value: function namespace() {\n      return \"stock-tracker\";\n    }\n  }, {\n    key: \"store\",\n    value: function store() {\n      return \"authentication\";\n    }\n  }]);\n\n  return AuthenticationDuck;\n}(Duck);\n\nexport var authenticationDuck = new AuthenticationDuck();","map":{"version":3,"sources":["/home/igor/Documentos/Programa de Formação Investtools/ReactNative/stock-tracker-aula/src/ducks/AuthenticationDuck.ts"],"names":["Duck","AsyncStorage","AuthenticationDuck","LOAD_TOKEN","type","SIGN_OUT","SIGN_IN_PENDING","SIGN_IN_FULFILLED","SIGN_IN_REJECTED","state","action","initialState","authToken","token","isLoading","isSignout","dispatch","dummyToken","setItem","setTimeout","SIGN_IN","removeItem","getItem","authenticationDuck"],"mappings":"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","sourcesContent":["import { Duck } from \"./Duck\";\nimport { Action } from \"redux\";\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\n\n\nexport interface AuthState {\n  isLoading: boolean;\n  authToken: string | null;\n}\n\ninterface LoadTokenAction extends Action<string> {\n  token: string | null;\n}\ntype SignOutAction = Action<string>;\n\n\ninterface SignInAction extends Action<string> {\n  token: string | null;\n}\n\ntype AuthAction = LoadTokenAction | SignOutAction | SignInAction;\n\nclass AuthenticationDuck extends Duck<AuthState, AuthAction> {\n  public readonly LOAD_TOKEN = this.type(\"LOAD_TOKEN\");\n  public readonly SIGN_OUT = this.type(\"SIGN_OUT\");\n  public readonly SIGN_IN_PENDING = this.type(\"SIGN_IN_PENDING\");\n  public readonly SIGN_IN_FULFILLED = this.type(\"SIGN_IN_FULFILLED\");\n  public readonly SIGN_IN_REJECTED = this.type(\"SIGN_IN_REJECTED\");\n\n  public reducer(state: AuthState, action: Action) {\n    if (!state) {\n      return this.initialState();\n    }\n    switch (action.type) {\n      case this.LOAD_TOKEN:\n        return {\n          ...state,\n          authToken: (action as LoadTokenAction).token,\n          isLoading: false,\n        };\n      case this.SIGN_IN_PENDING:\n        return {\n          ...state,\n          authToken: (action as SignInAction).token,\n          isLoading: true,\n        };\n      case this.SIGN_OUT:\n        return {\n          ...state,\n          authToken: null,\n          isSignout: true,\n        };\n      default:\n        return state;\n    }\n  }\n\n  public signIn() {\n    return async (dispatch: any) =>{ {\n      \n      try{\n        const dummyToken = \"12345678910\";\n        await AsyncStorage.setItem(\"@auth_token\", dummyToken);\n        setTimeout(() => dispatch({ type: this.SIGN_IN, token: dummyToken }), 3000);\n\n      }catch(err){\n\n      }\n    };\n  }\n}\n\n  public signOut(){\n    return async  (dispatch: any) => {\n      await AsyncStorage.removeItem(\"@auth_token\");\n      dispatch({ type: this.SIGN_OUT });\n    };\n  }\n\n  public loadToken() {\n    return async (dispatch: any) => {\n      let authToken: string | null;\n\n      try {\n        authToken = await AsyncStorage.getItem(\"@auth_token\");\n      } catch (e) {\n        // error\n      }\n\n      setTimeout(() => {dispatch({ type: this.LOAD_TOKEN, token: authToken });}, 3000)\n    };\n  }\n\n  protected initialState(): AuthState {\n    return {\n      isLoading: true,\n      authToken: null,\n    };\n  }\n  protected namespace(): string {\n    return \"stock-tracker\";\n  }\n\n  protected store(): string {\n    return \"authentication\";\n  }\n}\n\n\n\nexport const authenticationDuck =  new AuthenticationDuck()\n\n"]},"metadata":{},"sourceType":"module"}